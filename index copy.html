<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Prot√≥tipo Sankofa</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; }
  #cy { width: 100vw; height: 100vh; display: block; }
  #sankofa-btn {
    position: fixed;
    top: 20px; right: 20px;
    background: #ff6600;
    color: white;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    z-index: 999;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }
  #sankofa-btn:hover { background: #e55a00; }
  
  /* Painel Sankofa Adaptativo */
  #sankofa-panel-container {
    position: fixed;
    z-index: 1000;
    background: rgba(0,0,0,0.5);
    transition: all 0.3s ease;
    opacity: 0;
    pointer-events: none;
  }
  
  #sankofa-panel-container.show {
    opacity: 1;
    pointer-events: all;
  }
  
  #sankofa-panel {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    transform: translateY(100%);
    transition: transform 0.3s ease;
  }
  
  #sankofa-panel-container.show #sankofa-panel {
    transform: translateY(0);
  }
  
  /* Orienta√ß√£o Portrait (Mobile/Tablet vertical) - Bottom Sheet */
  @media screen and (orientation: portrait) {
    #sankofa-panel-container {
      bottom: 0;
      left: 0;
      right: 0;
      height: 100%;
      align-items: flex-end;
      display: flex;
    }
    
    #sankofa-panel {
      width: 100%;
      max-height: 60vh;
      border-radius: 15px 15px 0 0;
      margin: 0;
    }
  }
  
  /* Orienta√ß√£o Landscape (Desktop/Tablet horizontal) - Painel Lateral */
  @media screen and (orientation: landscape) {
    #sankofa-panel-container {
      top: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    
    #sankofa-panel {
      width: 90%;
      max-width: 400px;
      max-height: 80vh;
      margin-right: 20px;
      transform: translateX(100%);
    }
    
    #sankofa-panel-container.show #sankofa-panel {
      transform: translateX(0);
    }
  }
  
  #sankofa-panel h2 {
    color: #ff6600;
    margin-bottom: 15px;
    font-size: 22px;
  }
  
  #sankofa-panel p {
    color: #333;
    line-height: 1.6;
    margin-bottom: 20px;
    font-size: 15px;
  }
  
  .panel-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  
  #tracar-caminho-btn {
    background: #ff6600;
    color: white;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
    flex: 1;
  }
  
  #tracar-caminho-btn:hover { background: #e55a00; }
  
  #fechar-panel-btn {
    background: #ccc;
    color: #333;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
  }
  
  #fechar-panel-btn:hover { background: #999; }

  /* Badges de numera√ß√£o Sankofa */
  .sankofa-badge {
    position: absolute;
    background: #fff;
    color: #ff6600;
    border: 2px solid #ff6600;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 12px;
    z-index: 1001;
    pointer-events: none;
    opacity: 0;
    transform: scale(0.5);
    transition: all 0.3s ease;
  }
  
  .sankofa-badge.show {
    opacity: 1;
    transform: scale(1);
  }

  /* Welcome Screen */
  #welcome-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
  }

  #welcome-screen.show {
    opacity: 1;
    pointer-events: all;
  }

  #welcome-content {
    background: white;
    border-radius: 15px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    transform: scale(0.9);
    transition: transform 0.3s ease;
  }

  #welcome-screen.show #welcome-content {
    transform: scale(1);
  }

  /* Responsividade do Welcome */
  @media screen and (orientation: portrait) and (max-width: 768px) {
    #welcome-screen {
      align-items: flex-end;
    }
    
    #welcome-content {
      width: 100%;
      max-height: 75vh;
      border-radius: 15px 15px 0 0;
      overflow-y: auto;
      transform: translateY(100%);
    }
    
    #welcome-screen.show #welcome-content {
      transform: translateY(0);
    }
  }

  #welcome-content h1 {
    color: #ff6600;
    margin-bottom: 20px;
    font-size: 24px;
  }

  #welcome-content p {
    color: #333;
    line-height: 1.6;
    margin-bottom: 15px;
    font-size: 16px;
  }

  .exploration-option {
    background: #f8f9fa;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    padding: 20px;
    margin: 15px 0;
    text-align: left;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .exploration-option:hover {
    border-color: #ff6600;
    background: #fff5f0;
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(255, 102, 0, 0.15);
  }

  .exploration-option:active {
    transform: translateY(0);
  }

  .exploration-option h3 {
    color: #ff6600;
    margin: 0 0 10px 0;
    font-size: 18px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .exploration-option p {
    margin: 0;
    font-size: 15px;
    color: #555;
    line-height: 1.5;
  }

  .exploration-option::after {
    content: "‚Üí";
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%) translateX(10px);
    color: #ff6600;
    font-size: 20px;
    font-weight: bold;
    opacity: 0;
    transition: all 0.3s ease;
  }

  .exploration-option:hover::after {
    opacity: 1;
    transform: translateY(-50%) translateX(0);
  }

  .welcome-buttons {
    display: flex;
    justify-content: center;
    margin-top: 25px;
  }

  .welcome-btn.tertiary {
    background: transparent;
    color: #6c757d;
    border: 1px solid #dee2e6;
    font-size: 12px;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .welcome-btn.tertiary:hover {
    background: #f8f9fa;
    color: #495057;
  }

  /* √çcone Info discreto */
  #info-btn {
    position: fixed;
    top: 20px;
    right: 80px;
    width: 30px;
    height: 30px;
    background: rgba(255,255,255,0.9);
    color: #ff6600;
    border: 1px solid #ff6600;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 14px;
    z-index: 999;
    transition: all 0.3s ease;
  }

  #info-btn:hover {
    background: #ff6600;
    color: white;
    transform: scale(1.1);
  }

  #info-btn.show {
    display: flex;
  }

  /* Call-to-Action ap√≥s destacar trilha */
  #cta-panel {
    position: fixed;
    bottom: 20px;
    left: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ff6600 0%, #e55a00 100%);
    color: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    transform: translateY(100px);
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s ease;
    z-index: 1500;
    max-width: 600px;
    margin: 0 auto;
  }

  #cta-panel.show {
    transform: translateY(0);
    opacity: 1;
    pointer-events: all;
  }

  /* Responsividade do CTA */
  @media screen and (min-width: 768px) {
    #cta-panel {
      bottom: 30px;
      left: auto;
      right: 30px;
      max-width: 400px;
      margin: 0;
    }
  }

  .cta-content h3 {
    margin: 0 0 10px 0;
    font-size: 18px;
    font-weight: bold;
  }

  .cta-content p {
    margin: 0 0 15px 0;
    font-size: 14px;
    opacity: 0.9;
    line-height: 1.4;
  }

  .cta-buttons {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .cta-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
  }

  .cta-btn.primary {
    background: white;
    color: #ff6600;
    flex: 1;
  }

  .cta-btn.primary:hover {
    background: #f8f9fa;
    transform: translateY(-1px);
  }

  .cta-btn.close {
    background: rgba(255,255,255,0.2);
    color: white;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    line-height: 1;
  }

  .cta-btn.close:hover {
    background: rgba(255,255,255,0.3);
  }
</style>
<script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
</head>
<body>

<div id="cy"></div>
<div id="sankofa-btn">Sankofa</div>
<div id="info-btn" title="Como usar">?</div>

<!-- Welcome Screen -->
<div id="welcome-screen">
  <div id="welcome-content">
    <h1>Bem-vindo ao Prot√≥tipo Sankofa</h1>
    <p>Escolha como voc√™ gostaria de explorar os conceitos:</p>
    
    <div class="exploration-option" id="explore-free-option">
      <h3>üîç Explora√ß√£o Livre</h3>
      <p>Clique nos n√≥s para descobrir conex√µes e explorar os conceitos no seu pr√≥prio ritmo. Ideal para uma investiga√ß√£o curiosa e personalizada.</p>
    </div>
    
    <div class="exploration-option" id="follow-sankofa-option">
      <h3>üß≠ Explora√ß√£o Guiada</h3>
      <p>Siga o caminho Sankofa para uma vis√£o geral estruturada dos conceitos principais. Um percurso pensado para dar contexto antes do aprofundamento.</p>
    </div>
    
    <div class="welcome-buttons">
      <button class="welcome-btn tertiary" id="dont-show-again-btn">N√£o mostrar novamente</button>
    </div>
  </div>
</div>

<!-- Painel Sankofa Adaptativo -->
<div id="sankofa-panel-container">
  <div id="sankofa-panel">
    <h2>Sankofa</h2>
    <p>
      <strong>Sankofa</strong> √© um s√≠mbolo Adinkra que significa "voltar e buscar". 
      Representa a import√¢ncia de aprender com o passado para construir um futuro melhor.
      No contexto desta pesquisa, simboliza a recupera√ß√£o e valoriza√ß√£o dos saberes negros 
      como forma de resist√™ncia ao epistemic√≠dio.
    </p>
    <div class="panel-buttons">
      <button id="tracar-caminho-btn">Tra√ßar Caminho Sankofa</button>
      <button id="fechar-panel-btn">Fechar</button>
    </div>
  </div>
</div>

<!-- Call-to-Action para explorar trilha -->
<div id="cta-panel">
  <div class="cta-content">
    <h3 id="cta-title">Pronto para se aprofundar?</h3>
    <p id="cta-question">Como esses conceitos impactam sua realidade cotidiana?</p>
    <div class="cta-buttons">
      <a href="#" class="cta-btn primary" id="explore-btn">Explorar Trilha Completa</a>
      <button class="cta-btn close" id="close-cta-btn">√ó</button>
    </div>
  </div>
</div>

<script>
  // Dados da rede
  const nodesData = [
    // Grupo 1: Epistemic√≠dio e Estruturas de Opress√£o
    { id: 'racializacao', label: 'Racializa√ß√£o', grupo: 'epistemicidio' },
    { id: 'colonialidadeSaber', label: 'Colonialidade do Saber', grupo: 'epistemicidio' },
    { id: 'branquitude', label: 'Branquitude', grupo: 'epistemicidio' },
    { id: 'epistemicidio', label: 'Epistemic√≠dio', grupo: 'epistemicidio', importance: 'high' },
    
    // Grupo 2: Tecnologia e Algoritmos
    { id: 'tecnologia', label: 'Tecnologia', grupo: 'tecnologia' },
    { id: 'ia', label: 'Intelig√™ncia Artificial', grupo: 'tecnologia' },
    { id: 'racismoAlgoritmico', label: 'Racismo Algor√≠tmico', grupo: 'tecnologia' },
    { id: 'epistemicidioAlgoritmico', label: 'Epistemic√≠dio Algor√≠tmico', grupo: 'tecnologia', importance: 'high' },

    // Grupo 3: Educa√ß√£o e Resist√™ncia
    { id: 'reexistencia', label: 'Reexist√™ncia', grupo: 'educacao' },
    { id: 'saberesNegros', label: 'Saberes Negros', grupo: 'educacao' },
    { id: 'ept', label: 'Educa√ß√£o Profissional e Tecnol√≥gica', grupo: 'educacao', importance: 'high' }
  ];

  const edgesData = [
    // Conex√µes dentro dos grupos
    { source: 'epistemicidio', target: 'branquitude' },
    { source: 'epistemicidio', target: 'colonialidadeSaber' },
    { source: 'epistemicidio', target: 'racializacao' }, 

    { source: 'epistemicidioAlgoritmico', target: 'tecnologia' },
    { source: 'epistemicidioAlgoritmico', target: 'ia' },
    { source: 'epistemicidioAlgoritmico', target: 'racismoAlgoritmico' },

    { source: 'ept', target: 'reexistencia' },
    { source: 'ept', target: 'saberesNegros' },

    // Conex√µes entre os n√≥s pais (grupos)
    { source: 'epistemicidio', target: 'epistemicidioAlgoritmico' },
    { source: 'epistemicidioAlgoritmico', target: 'ept' },
  ];

  const cy = cytoscape({
    container: document.getElementById('cy'),
    elements: [
      ...nodesData.map(n => ({ 
        data: { id: n.id, label: n.label, importance: n.importance, grupo: n.grupo },
        classes: n.grupo // Adiciona a classe CSS baseada no grupo
      })),
      ...edgesData.map(e => ({ data: { source: e.source, target: e.target } })),
    ],
    style: [
      { selector: 'node',
        style: {
          'background-color': '#666',
          'label': 'data(label)',
          'color': '#fff',
          'text-valign': 'center',
          'text-halign': 'center',
          'font-size': 12,
          'width': 100,
          'height': 100,
          'text-wrap': 'wrap',
          'text-max-width': 90
        }
      },
      { selector: 'node.epistemicidio',
        style: {
          'background-color': '#8B0000',
          'border-color': '#650000',
          'border-width': 2
        }
      },
      { selector: 'node.tecnologia',
        style: {
          'background-color': '#2E8B57',
          'border-color': '#1F5F3F',
          'border-width': 2
        }
      },
      { selector: 'node.educacao',
        style: {
          'background-color': '#4682B4',
          'border-color': '#2F4F4F',
          'border-width': 2
        }
      },
      { selector: 'node[importance = "high"]',
        style: {
          'width': 130,
          'height': 130,
          'font-size': 14,
          'font-weight': 'bold',
          'border-width': 3,
          'border-color': '#8B0000',
          'box-shadow': '0 0 20px rgba(220, 20, 60, 0.6)',
          'text-wrap': 'wrap',
          'text-max-width': 90,
        }
      },
      { selector: 'edge',
        style: {
          'width': 2,
          'line-color': '#ccc',
          'curve-style': 'bezier'
        }
      },
      { selector: '.highlighted',
        style: {
          'background-color': '#ff6600',
          'line-color': '#ff6600',
          'transition-duration': '0.5s'
        }
      },
      { selector: '.hovered',
        style: {
          'width': 120,
          'height': 120,
          'border-width': 3,
          'border-color': '#ff6600',
          'transition-duration': '0.3s',
          'z-index': 999
        }
      },
      { selector: '.group-highlighted',
        style: {
          'border-width': 4,
          'border-opacity': 1,
          'transition-duration': '0.5s',
          'z-index': 998
        }
      }
    ],
    layout: { 
      name: 'cose', 
      animate: true,
      componentSpacing: 100,
      nodeOverlap: 20,
      idealEdgeLength: 100,
      edgeElasticity: 100,
      nestingFactor: 5
    }
  });

  let sankofaActive = false;
  let activeGroup = null; // Para controlar qual grupo est√° destacado
  const sankofaPath = ['epistemicidio', 'epistemicidioAlgoritmico', 'ept'];

  // Configura√ß√µes para Call-to-Action de cada trilha
  const trilhaConfig = {
    'sankofa': {
      title: 'Caminho Sankofa Revelado',
      question: 'Como podemos resgatar saberes ancestrais para resistir ao epistemic√≠dio digital?',
      page: 'trilha.html',
      param: 'sankofa'
    },
    'epistemicidio': {
      title: 'Estruturas de Opress√£o',
      question: 'De que formas o epistemic√≠dio se manifesta em sua experi√™ncia acad√™mica?',
      page: 'trilha.html',
      param: 'epistemicidio'
    },
    'tecnologia': {
      title: 'Tecnologia e Algoritmos',
      question: 'Como os algoritmos reproduzem desigualdades em nosso dia a dia?',
      page: 'trilha.html',
      param: 'tecnologia'
    },
    'educacao': {
      title: 'Educa√ß√£o e Resist√™ncia',
      question: 'Que papel a educa√ß√£o tem na constru√ß√£o de uma sociedade mais justa?',
      page: 'trilha.html',
      param: 'educacao'
    }
  };

  // Sistema de Welcome Screen e LocalStorage
  const STORAGE_KEY = 'sankofa-first-visit';
  
  function checkFirstVisit() {
    const hasVisited = localStorage.getItem(STORAGE_KEY);
    if (!hasVisited) {
      showWelcomeScreen();
    } else {
      showInfoButton();
    }
  }
  
  function showWelcomeScreen() {
    const welcomeScreen = document.getElementById('welcome-screen');
    setTimeout(() => {
      welcomeScreen.classList.add('show');
    }, 500);
  }
  
  function hideWelcomeScreen() {
    const welcomeScreen = document.getElementById('welcome-screen');
    welcomeScreen.classList.remove('show');
    setTimeout(() => {
      showInfoButton();
    }, 300);
  }
  
  function showInfoButton() {
    document.getElementById('info-btn').classList.add('show');
  }
  
  function markAsVisited() {
    localStorage.setItem(STORAGE_KEY, 'true');
  }

  // Fun√ß√µes para Call-to-Action
  function showCTA(trilhaType) {
    const config = trilhaConfig[trilhaType];
    if (!config) return;

    // Atualizar conte√∫do do CTA
    document.getElementById('cta-title').textContent = config.title;
    document.getElementById('cta-question').textContent = config.question;
    
    // Configurar link de explora√ß√£o
    const exploreBtn = document.getElementById('explore-btn');
    exploreBtn.href = `${config.page}?trilha=${config.param}`;
    
    // Mostrar CTA com delay para n√£o conflitar com anima√ß√µes
    setTimeout(() => {
      document.getElementById('cta-panel').classList.add('show');
    }, 1200);
  }

  function hideCTA() {
    document.getElementById('cta-panel').classList.remove('show');
  }

  // Event listeners do CTA
  document.getElementById('close-cta-btn').addEventListener('click', hideCTA);
  
  // Fechar CTA quando clicar no fundo da rede (al√©m dos outros resets)
  function handleBackgroundTap() {
    hideCTA();
  }

  // Fun√ß√£o para destacar grupo de n√≥s
  function highlightGroup(groupName) {
    // Limpar destaques anteriores
    cy.nodes().removeClass('group-highlighted');
    hideCTA(); // Esconder CTA anterior
    
    // Desativar trilha Sankofa se estiver ativa
    if (sankofaActive) {
      cy.elements().removeClass('highlighted');
      removeAllNumberBadges();
      sankofaActive = false;
    }
    
    if (activeGroup === groupName) {
      // Se o grupo j√° est√° ativo, desativa
      activeGroup = null;
      return;
    }
    
    // Destacar todos os n√≥s do grupo
    cy.nodes(`.${groupName}`).addClass('group-highlighted');
    activeGroup = groupName;
    
    // Animar para focar no grupo
    cy.animate({
      fit: { eles: cy.nodes(`.${groupName}`), padding: 80 },
      duration: 800
    });
    
    // Mostrar CTA ap√≥s destaque
    showCTA(groupName);
  }

  // Fun√ß√£o para ativar o caminho Sankofa (reutiliz√°vel)
  function activateSankofaPath() {
    // Limpar estados anteriores
    activeGroup = null;
    cy.nodes().removeClass('group-highlighted');
    hideCTA(); // Esconder CTA anterior
    
    if (sankofaActive) {
      // Se j√° est√° ativo, desativar
      sankofaActive = false;
      cy.elements().removeClass('highlighted');
      document.querySelectorAll('.number-badge').forEach(badge => badge.remove());
      return;
    }
    
    // Ativar destaque
    cy.elements().removeClass('highlighted');
    
    // Destacar n√≥s do caminho
    sankofaPath.forEach((id, index) => {
      const node = cy.getElementById(id);
      node.addClass('highlighted');
      
      // Criar badge de numera√ß√£o
      createNumberBadge(node, index + 1);
    });
    
    // Destacar as conex√µes
    for (let i = 0; i < sankofaPath.length - 1; i++) {
      cy.getElementById(sankofaPath[i]).edgesTo(cy.getElementById(sankofaPath[i+1])).addClass('highlighted');
    }

    cy.animate({
      fit: { eles: cy.elements('.highlighted'), padding: 50 },
      duration: 1000
    });
    sankofaActive = true;
    
    // Mostrar CTA da trilha Sankofa
    showCTA('sankofa');
  }  // Event Listeners do Welcome Screen
  document.getElementById('explore-free-option').addEventListener('click', () => {
    hideWelcomeScreen();
    // N√ÉO marca como visitado - welcome aparecer√° novamente
  });
  
  document.getElementById('follow-sankofa-option').addEventListener('click', () => {
    hideWelcomeScreen();
    // N√ÉO marca como visitado - welcome aparecer√° novamente
    // Ativa diretamente o caminho Sankofa sem passar pelo painel explicativo
    setTimeout(() => {
      activateSankofaPath();
    }, 800); // Delay um pouco maior para transi√ß√£o suave
  });
  
  document.getElementById('dont-show-again-btn').addEventListener('click', () => {
    hideWelcomeScreen();
    markAsVisited(); // APENAS aqui marca como visitado permanentemente
  });
  
  // √çcone Info funciona como bot√£o Sankofa alternativo
  document.getElementById('info-btn').addEventListener('click', () => {
    document.getElementById('sankofa-panel-container').classList.add('show');
  });

  // Inicializar sistema de primeira visita
  window.addEventListener('load', () => {
    setTimeout(checkFirstVisit, 1000); // Aguarda carregar completamente
  });

  // Funcionalidade do painel Sankofa
  document.getElementById('sankofa-btn').addEventListener('click', () => {
    document.getElementById('sankofa-panel-container').classList.add('show');
  });

  // Fechar painel
  document.getElementById('fechar-panel-btn').addEventListener('click', () => {
    document.getElementById('sankofa-panel-container').classList.remove('show');
  });

  // Fechar painel clicando fora
  document.getElementById('sankofa-panel-container').addEventListener('click', (e) => {
    if (e.target.id === 'sankofa-panel-container') {
      document.getElementById('sankofa-panel-container').classList.remove('show');
    }
  });

  // Tra√ßar Caminho Sankofa
  document.getElementById('tracar-caminho-btn').addEventListener('click', () => {
    // Fechar o painel
    document.getElementById('sankofa-panel-container').classList.remove('show');
    
    // Usar a fun√ß√£o reutiliz√°vel
    setTimeout(() => {
      activateSankofaPath();
    }, 300);
  });

  // Resetar caminho Sankofa clicando no fundo da rede
  cy.on('tap', (evt) => {
    if (evt.target === cy) {
      if (sankofaActive) {
        // Remover destaque Sankofa
        cy.elements().removeClass('highlighted');
        removeAllNumberBadges();
        sankofaActive = false;
      } else if (activeGroup) {
        // Remover destaque de grupo
        cy.nodes().removeClass('group-highlighted');
        activeGroup = null;
      }
      
      // Esconder CTA
      hideCTA();
      
      // Resetar visualiza√ß√£o
      cy.animate({
        fit: { eles: cy.elements(), padding: 50 },
        duration: 1000
      });
    }
  });

  // Event listeners para hover/touch nos n√≥s
  cy.on('mouseover', 'node', function(evt) {
    const node = evt.target;
    if (!node.hasClass('highlighted')) { // N√£o interfere com n√≥s do caminho Sankofa
      node.addClass('hovered');
    }
  });

  cy.on('mouseout', 'node', function(evt) {
    const node = evt.target;
    node.removeClass('hovered');
  });

  // Event listeners para clique/tap nos n√≥s
  cy.on('tap', 'node', function(evt) {
    const node = evt.target;
    
    // Remove hover de todos os outros n√≥s
    cy.nodes().removeClass('hovered');
    
    if (!node.hasClass('highlighted')) { // N√£o interfere com n√≥s do caminho Sankofa
      // Pegar o grupo do n√≥ clicado
      const nodeData = node.data();
      const nodeGroup = nodeData.grupo;
      
      if (nodeGroup) {
        // Destacar todo o grupo
        highlightGroup(nodeGroup);
      } else {
        // Se n√£o tem grupo, apenas adiciona hover tempor√°rio
        node.addClass('hovered');
        setTimeout(() => {
          node.removeClass('hovered');
        }, 2000);
      }
    }
  });

  // Fun√ß√µes para gerenciar badges de numera√ß√£o
  function createNumberBadge(node, number) {
    const nodePosition = node.renderedPosition();
    const nodeWidth = node.renderedWidth();
    const nodeHeight = node.renderedHeight();
    
    const badge = document.createElement('div');
    badge.className = 'sankofa-badge';
    badge.textContent = number;
    badge.id = `badge-${node.id()}`;
    
    // Posicionar o badge no canto superior direito do n√≥
    badge.style.left = `${nodePosition.x + nodeWidth/2 - 5}px`;
    badge.style.top = `${nodePosition.y - nodeHeight/2 - 5}px`;
    
    document.body.appendChild(badge);
    
    // Animar entrada do badge
    setTimeout(() => {
      badge.classList.add('show');
    }, 100);
    
    // Atualizar posi√ß√£o quando o layout mudar
    const updateBadgePosition = () => {
      const newPosition = node.renderedPosition();
      badge.style.left = `${newPosition.x + nodeWidth/2 - 5}px`;
      badge.style.top = `${newPosition.y - nodeHeight/2 - 5}px`;
    };
    
    // Listener para atualiza√ß√µes de posi√ß√£o
    cy.on('position', `#${node.id()}`, updateBadgePosition);
    cy.on('zoom pan', updateBadgePosition);
    
    // Armazenar refer√™ncia para limpeza
    badge._updateFunction = updateBadgePosition;
  }
  
  function removeAllNumberBadges() {
    const badges = document.querySelectorAll('.sankofa-badge');
    badges.forEach(badge => {
      badge.classList.remove('show');
      
      // Remover listeners
      if (badge._updateFunction) {
        cy.off('position zoom pan', badge._updateFunction);
      }
      
      // Remover elemento ap√≥s anima√ß√£o
      setTimeout(() => {
        if (badge.parentNode) {
          badge.parentNode.removeChild(badge);
        }
      }, 300);
    });
  }
  
  // Fun√ß√£o para reset (√∫til para testes) - pode ser chamada no console
  window.resetFirstVisit = function() {
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  };
</script>

</body>
</html>
